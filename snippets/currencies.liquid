
{{ "//cdn.shopify.com/s/javascripts/currencies.js" | script_tag }}
{% comment %}{{ "currencies-rate.js" | asset_url | script_tag }}{% endcomment %}
{{ "currencies.js" | asset_url | script_tag }}

<script>
  function getLanguageFromURL() {
    let url = window.location.href;

    let match = url.match(/\/([a-z]{2})(?:\/|$)/);

    return match ? match[1] : null;
  }

  let languageFromURL = getLanguageFromURL() ? getLanguageFromURL() : 'uk';


  if (languageFromURL === 'en') {  
    Currency.convertAll('UAH', 'USD');
  }

  {% if template contains 'product' %}
    // Function to find the button once it's loaded
    function waitForPriceBlock(selector) {
      return new Promise((resolve) => {
        const observer = new MutationObserver((mutations, me) => {
            const button = document.querySelector(selector);
            if (button) {
                me.disconnect();
                resolve(button);
            }
        });

        observer.observe(document, {
            childList: true,
            subtree: true
        });
      });
    }

    waitForPriceBlock('span.mw-price').then((button) => {
      if (languageFromURL === 'en') {  
        Currency.convertAll('UAH', 'USD');
      }
    });
  {% endif %}
</script>
